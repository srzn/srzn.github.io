<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
body{ font: Arial 12px; text-align: center;}
.axis path, .axis line{
fill: none;
stroke: black;
stroke-width: 1;
shape-rendering: crispEdges;
}
</style>
</head>
<body>
<h3>Covid-19 Trend(s) in the US</h3>
</body>
<div id="my_dataviz"></div>
<script>
//Set margins and sizes
var margin = {
top: 20,
bottom: 50,
right: 30,
left: 50
};

var width = 700 - margin.left - margin.right;
var height = 500 - margin.top - margin.bottom;
//Create date parser
var ParseDate = d3.timeParse("%Y-%m-%dT%H:%M:%SZ");




//Create an SVG element and append it to the DOM
var svgElement = d3.select("#my_dataviz").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read CSV file

var prm = [d3.csv("https://srzn.github.io/DataViz/Covid-US-Dec-14.csv")];

myDataPromises = Promise.all(prm);


myDataPromises.then(function(data) {

//Parse Data into useable format
data=data[0];
console.log(data);
data.forEach(function(d){
d.date = ParseDate(d.date);
console.log(d.date);
d.new_cases = +d.hosp_patients;
console.log(d.new_cases);
//the + sign converts string automagically to number
});

//Create x and y scale to scale inputs
var xScale = d3.scaleTime()
             .domain(d3.extent(data, function(d){ return d.date; }))
             .range([0, width]);
var yScale = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return d.new_cases; })]).nice()
             .range([height, 0]);

//Create x and y axes
var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %y"));

var yAxis = d3.axisLeft(yScale).ticks(null,"s");

//Set the domains of our scales
//xScale.domain(d3.extent(data, function(d){ return d.date; }));
//yScale.domain([0, d3.max(data, function(d){ return d.new_cases; })]);

//Create a area generator
var area = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_cases);
});

var valueline = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });


//append the svg path
svgElement.append("path")
.data([data])
.attr("fill","#cce5df")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d", area);


//svgElement.append("path")
//      .data([data])
//      .attr("class", "line")
//      .attr("d", valueline);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.call(yAxis);

//Add label to Y axis

});

myDataPromises.catch(function() {
	console.log('Something has gone wrong.')
});

</script>

</html>