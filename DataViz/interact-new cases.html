<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
body{ font-family: 'Trebuchet MS', sans-serif; text-align: center;}
.axis path, .axis line{
fill: none;
stroke: black;
stroke-width: 1;
shape-rendering: crispEdges;
}
</style>
</head>
<body>
<h3>Recent Covid-19 Trend(s) in the US</h3>

<select id="selectButton"></select>
<div id="my_dataviz"></div>
<script>
//Set margins and sizes
var margin = {
top: 20,
bottom: 50,
right: 30,
left: 50
};

var width = 700 - margin.left - margin.right;
var height = 500 - margin.top - margin.bottom;
//Create date parser
var ParseDate = d3.timeParse("%Y-%m-%dT%H:%M:%SZ");




//Create an SVG element and append it to the DOM
var svgElement = d3.select("#my_dataviz").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read CSV file




var prm = [d3.csv("https://srzn.github.io/DataViz/Covid-US-Dec-14.csv")];

myDataPromises = Promise.all(prm);


myDataPromises.then(function(data) {

//Parse Data into useable format
data=data[0];
//console.log(data);
data.forEach(function(d){
d.date = ParseDate(d.date);
//console.log(d.date);
d.new_cases = +d.new_cases_smoothed_per_million;
//console.log(d.new_cases);
d.new_vax = (+d.people_fully_vaccinated_per_hundred)*10;

d.tot_cases = +d.total_cases

d.full_vax = +d.people_fully_vaccinated

//the + sign converts string automagically to number
});


// Drop down

var cases_sel = ["New Cases per million","Total Cases"];
let allGroup = Array.from(cases_sel);


d3.select("#selectButton")
    .selectAll('myOptions')
    .data(allGroup)
    .enter()
    .append('option')
    .text(function (d) { return d; }) // text showed in the menu
    .attr("value", function (d,i) { return i; })


//Create x and y scale to scale inputs
var xScale = d3.scaleTime()
             .domain(d3.extent(data, function(d){ return d.date; }))
             .range([0, width]);
var yScale = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return d.new_cases; })]).nice()
             .range([height, 0]);

var yScale1 = d3.scaleLinear()
             .domain([1, d3.max(data, function(d){ return d.tot_cases; })]).nice()
             .range([height, 0]);

//Create x and y axes
var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %y"));

var yAxis = d3.axisLeft(yScale).ticks(null,"s");



//Set the domains of our scales
//xScale.domain(d3.extent(data, function(d){ return d.date; }));
//yScale.domain([0, d3.max(data, function(d){ return d.new_cases; })]);

//Create an area generator

var initialarea = d3.area()
  .x(function(d) { return xScale(d.date); })
  .y0(height)
  .y1(height);



var area = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_cases);
});


var area_vax = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_vax);
});


var valueline = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });


var valueline_vax = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_vax); });


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);



//append the svg path
svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(4300)
  .ease(d3.easeLinear)
  .attr("width", 700);












//svgElement.append("path")
//      .data([data])
//      .attr("class", "line")
//      .attr("d", valueline);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.call(yAxis)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", -48)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Number of Cases/Vaccinations");

//Add label to Y axis




function updateChart(selectedGroup) {
console.log(selectedGroup);
    // recompute line chart
if (selectedGroup==0){

var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });  

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_vax); });

var yAxis1 = d3.axisLeft(yScale).ticks(null,"s");
 
}
else{
console.log("in the else")
var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.tot_cases); });

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.full_vax); });

var yAxis1 = d3.axisLeft(yScale1).ticks(null,"s");

}
  


    // update the chart
svgElement.selectAll("*").remove();


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline1)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax1)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(4300)
  .ease(d3.easeLinear)
  .attr("width", 700);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.call(yAxis1)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", -48)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Number of Cases/Vaccinations");

//Add label to Y axis



}

  // Listen to the slider?
  d3.select("#selectButton").on("change", function(d){
    selectedGroup = this.value
    updateChart(selectedGroup)
  })




});

myDataPromises.catch(function() {
	console.log('Something has gone wrong.')
});



</script>
</body>
</html>