<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<style>
body{ font-family: 'Trebuchet MS', sans-serif; text-align: center;}
.annotation text {
      
      font-size: 10px;
    }
.axis path, .axis line{
fill: none;
stroke: black;
stroke-width: 1;
shape-rendering: crispEdges;
}

.axisRed line{
  stroke: red;
}

.axisRed path{
  stroke: red;
}

.axisRed text{
  fill: red;
  font-size: 13px;
} 

.axisGreen line{
  stroke: #69b3a2;
}

.axisGreen path{
  stroke: #69b3a2;
}

.axisGreen text{
  fill: #69b3a2;
  font-size: 13px;
} 


#selectButton {
  width: 170px;
  font-family: Trebuchet MS;
  font-size: 12px;
  
  height: 20px;
  
  /* padding: 100px; */
}



</style>
</head>
<body>
<h3>Recent Covid-19 Trend(s) in the US</h3>

<div style="width:1440px">
  <svg width="250" height="40" id="sp1" ></svg>
  <svg width="100" height="40" id="sp2" ></svg>
  <svg width="750" height="40" id="sp3"></svg>
</div>


<div style="width:1440px">
  <svg width="450" height="100" id="pages" ></svg>
  
  <svg width="650" height="100" id="my_dataviz_dummy"></svg>
</div>
<select id="selectButton"></select>
<div style="width:1440px">
  <svg width="250" height="500" id="sp_page" ></svg>
  <svg width="100" height="500" id="sp_spake" ></svg>
  <svg width="750" height="500" id="my_dataviz"></svg>
</div>
<script>

// Pages 

var width_b = 450;
var height_b = 100;
var word1 = "1";
var word2 = "2";
var word3 = "3";
var word4 = "4";
 
var holder = d3.select("#pages")
      .append("svg")
      .attr("width", width_b)    
      .attr("height", height_b); 

holder.append("text")
    .attr("x", 30)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "15px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("Pages");

holder.append("text")
    .attr("x", 30)
    .attr("y", 50)
    .style("fill", "black")
    .style("font-size", "12px")
    .attr("dx","8.6em")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("The chart on the right shows new covid-19 cases")

holder.append("text")
    .attr("x", 30)
    .attr("y", 63)
    .style("fill", "black")
    .style("font-size", "12px")
    .attr("dx","8.4em")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("recorded per day interspersed with cumulative")


holder.append("text")
    .attr("x", 30)
    .attr("y", 76)
    .style("fill", "black")
    .style("font-size", "12px")
    .attr("dx","8.9em")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("vaccination rate. A rough correlation can be seen")

holder.append("text")
    .attr("x", 30)
    .attr("y", 89)
    .style("fill", "black")
    .style("font-size", "12px")
    .attr("dx","5.6em")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("between the displayed line graphs")
     
// 


// draw a rectangle
holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20cases.html")
    .append("rect")  
    .attr("x", 60)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill","lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 70)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word1);

// Page 2

holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20hosp.html")
    .append("rect")  
    .attr("x", 85)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 95)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word2);



// Page 3

holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20deaths.html")
    .append("rect")  
    .attr("x", 110)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "black")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 120)
    .attr("y", 10)
    .style("fill", "white")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word3);




// Page 4 


holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20hosp.html")
    .append("rect")  
    .attr("x", 135)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 145)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word4);






//Set margins and sizes
var margin = {
top: 20,
bottom: 50,
right: 30,
left: 50
};
 
var width = 700 - margin.left - margin.right;

var height = 500 - margin.top - margin.bottom;
//Create date parser
var ParseDate = d3.timeParse("%Y-%m-%dT%H:%M:%SZ");




//Create an SVG element and append it to the DOM
var svgElement = d3.select("#my_dataviz").append("svg")
    .attr("width", width + margin.left + margin.right+50)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");




function mkannot1(svgElement){
// ------ Annotations 1 --------- //


// ==== RIGHT ====== //
const annotationsRight = [
  {
    note: {
      label: "First COVID-19 vaccine administered",
      title: "December 14, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 1,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 0,
    y: 430,
    dy: -40,
    dx: 5
  }
];

// Add annotation to the chart
const makeAnnotationsRight = d3.annotation().annotations(annotationsRight);
svgElement
  .append("g")
.attr('class', 'annotation-group')
  .call(makeAnnotationsRight)
;

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")



// ------ Annotations 1 -------- //

}

function mkannot2(svgElement){
// ------ Annotations 2 --------- //


// ==== RIGHT ====== //
const annotationsRight2 = [
  {
    note: {
      label: "US surpasses 500,000 deaths",
      title: "February 22, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 193,
    y: 430,
    dy: -100,
    dx: 30
  }
];

// Add annotation to the chart
const makeAnnotationsRight2 = d3.annotation().annotations(annotationsRight2);
svgElement
  .append("g")
  .call(makeAnnotationsRight2);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")

}
// ------ Annotations 2 -------- //


function mkannot2a(svgElement){

// ------ Annotations 2a --------- //


// ==== RIGHT ====== //
const annotationsRight2a = [
  {
    note: {
      label: "US reports record number of daily deaths",
      title: "January 13, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 80,
    y: 430,
    dy: -100,
    dx: 30
  }
];

// Add annotation to the chart
const makeAnnotationsRight2a = d3.annotation().annotations(annotationsRight2a);
svgElement
  .append("g")
  .call(makeAnnotationsRight2a);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 2a -------- //
}




function mkannot3(svgElement){

// ------ Annotations 3 --------- //


// ==== RIGHT ====== //
const annotationsRight3 = [
  {
    note: {
      label: "First few cases of Delta variant found in the US",
      title: "April 12, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 329,
    y: 430,
    dy: -200,
    dx: -5
  }
];

// Add annotation to the chart
const makeAnnotationsRight3 = d3.annotation().annotations(annotationsRight3);
svgElement
  .append("g")
  .call(makeAnnotationsRight3);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 3 -------- //

}

function mkannot4(svgElement){


// ------ Annotations 4 --------- //


// ==== RIGHT ====== //
const annotationsRight4 = [
  {
    note: {
      label: "CDC lifts mask mandates for fully vaccinated people",
      title: "May 13, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 420,
    y: 430,
    dy: -150,
    dx: 10
  }
];

// Add annotation to the chart
const makeAnnotationsRight4 = d3.annotation().annotations(annotationsRight4);
svgElement
  .append("g")
  .call(makeAnnotationsRight4);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 4 -------- //



}
function mkannot5(svgElement){

// ------ Annotations 5 --------- //


// ==== RIGHT ====== //
const annotationsRight5 = [
  {
    note: {
      label: "At least 50% of US adults(>18y) are fully vaccinated",
      title: "May 26, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 454,
    y: 430,
    dy: -270,
    dx: 45
  }
];

// Add annotation to the chart
const makeAnnotationsRight5 = d3.annotation().annotations(annotationsRight5);
svgElement
  .append("g")
  .call(makeAnnotationsRight5);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dashArray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 5 -------- //





}

//Read CSV file




var prm = [d3.csv("https://srzn.github.io/DataViz/Covid-US-Dec-14.csv")];

myDataPromises = Promise.all(prm);


myDataPromises.then(function(data) {

//Parse Data into useable format
data=data[0];
//console.log(data);
data.forEach(function(d){
d.date = ParseDate(d.date);
console.log(d.date);
d.new_cases = +d.new_deaths_smoothed_per_million;

d.new_vax = (+d.people_fully_vaccinated_per_hundred);
console.log(d.new_vax);
d.tot_cases = +d.total_deaths

d.full_vax = +d.people_fully_vaccinated

//the + sign converts string automagically to number
});


// Drop down

var cases_sel = ["New Deaths per million","Total Deaths"];
let allGroup = Array.from(cases_sel);


d3.select("#selectButton")
    .attr("x",100)
    .selectAll('myOptions')
    .data(allGroup)
    .enter()
    .append('option')
    .text(function (d) { return d; }) // text showed in the menu
    .attr("value", function (d,i) { return i; })


//Create x and y scale to scale inputs
var xScale = d3.scaleTime()
             .domain(d3.extent(data, function(d){ return d.date; }))
             .range([0, width]);
var yScale = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return Math.max(d.new_cases); })]).nice()
             .range([height, 0]);

var yScale_tot = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return Math.max(d.tot_cases); })]).nice()
             .range([height, 0]);


var yScale1 = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return Math.max(d.new_vax); })]).nice()
             .range([height, 0]);

//Create x and y axes
var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %Y"));

var yAxis = d3.axisLeft(yScale).ticks(null,"s");

var yAxis1 = d3.axisRight(yScale1).ticks(null,"s");

var yAxis_tot = d3.axisLeft(yScale_tot).ticks(null,"s");




//Set the domains of our scales
//xScale.domain(d3.extent(data, function(d){ return d.date; }));
//yScale.domain([0, d3.max(data, function(d){ return d.new_cases; })]);

//Create an area generator

var initialarea = d3.area()
  .x(function(d) { return xScale(d.date); })
  .y0(height)
  .y1(height);



var area = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_cases);
});


var area_vax = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_vax);
});


var valueline = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });


var valueline_vax = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.new_vax); });


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);



//append the svg path
svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(4000)
  .ease(d3.easeLinear)
  .attr("width", 700);

mkannot(0);

function mkannot(var_ant){
if(var_ant==0){
setTimeout(function() { mkannot1(svgElement); }, 100);
setTimeout(function() { mkannot2a(svgElement); }, 600);
setTimeout(function() { mkannot3(svgElement); }, 2000);
setTimeout(function() { mkannot4(svgElement); }, 2700);
setTimeout(function() { mkannot5(svgElement); }, 3000);
}
else{

setTimeout(function() { mkannot1(svgElement); }, 100);
setTimeout(function() { mkannot2(svgElement); }, 1600);
setTimeout(function() { mkannot3(svgElement); }, 2600);
setTimeout(function() { mkannot4(svgElement); }, 3500);
setTimeout(function() { mkannot5(svgElement); }, 3800);

}
}

//svgElement.append("path")
//      .data([data])
//      .attr("class", "line")
//      .attr("d", valueline);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.attr("class","axisRed")
.call(yAxis)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", -48)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("New Deaths per million");

var y1 = svgElement.append("g")
.attr("class","axisGreen")
.attr("transform", "translate( " + width + ", 0 )")
.call(yAxis1)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", 36)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Fully vaccinated people per 100");


//Add label to Y axis



function calltooltip(svgElement,data,xScale,yScale1,ysc,tot){


var rectOverlay = d3.select("#my_dataviz")
    .append("rect")
    .attr("cursor", "move")
    .attr("fill", "none")
    .attr("pointer-events", "all")
    .attr("width", width+50)
    .attr("height", height)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .on("mousemove", focusMouseMove)
    .on("mouseover", focusMouseOver)
    .on("mouseout", focusMouseOut);



var mouseLine = svgElement
    .append("path") // create vertical line to follow mouse
    .attr("class", "mouse-line")
    .attr("stroke", "grey")
    .attr("stroke-width", 1)
    .attr("opacity", "0");

  var tooltip = svgElement
    .append("g")
    .attr("class", "tooltip-wrapper")
    .attr("display", "none");

  var tooltipBackground = tooltip.append("rect").attr("fill", "#e8e8e8");

  var tooltipText = tooltip.append("text");


// ------ ------- //


  var dates = [];
  // group y axis values (value) of all lines to x axis (key)
  var groupValuesByX = {};
  var groupValuesByX1 = {};
 var groupValuesByX_tot ={};
  for (let key of Object.keys(data)) {
    //console.log("keys");
    //console.log(key);
if(isNaN(key)){
	console.log("Im inside insane loops")
	continue;
}
    //console.log("data[key]");
    //console.log(data[key]);

    
    bucketRecord = data[key];	
    
    dates.push(bucketRecord.date);
	//console.log("bucketrecord date")
	//console.log((bucketRecord.date))
    !(bucketRecord.date in groupValuesByX) && (groupValuesByX[bucketRecord.date] = {}); // if date as key does not exist then create
      groupValuesByX[bucketRecord.date][key] = bucketRecord.new_cases;

!(bucketRecord.date in groupValuesByX1) && (groupValuesByX1[bucketRecord.date] = {}); // if date as key does not exist then create
      groupValuesByX1[bucketRecord.date][key] = bucketRecord.new_vax;
    


!(bucketRecord.date in groupValuesByX_tot) && (groupValuesByX_tot[bucketRecord.date] = {}); // if date as key does not exist then create
      groupValuesByX_tot[bucketRecord.date][key] = bucketRecord.tot_cases;

  


}
  var availableDates = Object.keys(groupValuesByX);
  availableDates.sort(); // sort dates in increasing order
  //console.log(groupValuesByX);
  //console.log(availableDates);

// ------ -------- //



  function focusMouseMove() {
    tooltip.attr("display", null);
    var mouse = d3.pointer(event,svgElement.node());

console.log("mouse");
console.log(mouse);

    var dateOnMouse = xScale.invert(mouse[0]);
    var nearestDateIndex = d3.bisect(availableDates, dateOnMouse.toString());

console.log("mouse x val");
console.log(dateOnMouse);


console.log("Logged x val");
console.log(nearestDateIndex);
    // get the dates on either of the mouse cord
    var d0 = new Date(availableDates[nearestDateIndex - 1]);
    var d1 = new Date(availableDates[nearestDateIndex]);
    var closestDate;
    if (d0 < xScale.domain()[0]) {
      closestDate = d1;
    } else if (d1 > xScale.domain()[1]) {
      closestDate = d0;
    } else {
      // decide which date is closest to the mouse
      closestDate = dateOnMouse - d0 > d1 - dateOnMouse ? d1 : d0;
    }

console.log("closest date found");
console.log(closestDate);


    var nearestDateYValues = groupValuesByX[closestDate];
    var nearestDateYValues_tot = groupValuesByX_tot[closestDate];
    var nearestDateYValues1 = groupValuesByX1[closestDate];
    var lab_y = {};
    if(tot==0){
	hold_y=nearestDateYValues;
        lab_y = "New Deaths";

}
else{
hold_y=nearestDateYValues_tot;
lab_y = "Total Deaths";
}
    var nearestDateXCord = xScale(new Date(closestDate));

    mouseLine.attr("d", `M ${nearestDateXCord} 0 V ${height}`).attr("opacity", "1");

    tooltipText.selectAll(".tooltip-text-line").remove();
    svgElement.selectAll(".tooltip-line-circles").remove();
    //console.log(xScale.domain());
    var formatTime = d3.timeFormat("%b %d");
    tooltipText
      .append("tspan")
      .attr("class", "tooltip-text-line")
      .attr("x", "5")
      .attr("y", "5")
      .attr("dy", "11px")
      .attr("font-weight", "bold")
      .text(`${formatTime(closestDate)}`);

    for (let key of Object.keys(hold_y)) {
      svgElement
        .append("circle")
        .attr("class", "tooltip-line-circles")
        .attr("r", 4)
        .attr("fill", "red")
        .attr("cx", nearestDateXCord)
        .attr("cy", ysc(hold_y[key]));

      tooltipText
        .append("tspan")
        .attr("class", "tooltip-text-line")
        .attr("x", "5")
        .attr("dy", `19px`)
        .attr("fill", "black")
        .text(`${lab_y}: ${hold_y[key].toFixed(2)}`);
    }

for (let key of Object.keys(nearestDateYValues1)) {
      svgElement
        .append("circle")
        .attr("class", "tooltip-line-circles")
        .attr("r", 4)
        .attr("fill", "#69b3a2")
        .attr("cx", nearestDateXCord)
        .attr("cy", yScale1(nearestDateYValues1[key]));

      tooltipText
        .append("tspan")
        .attr("class", "tooltip-text-line")
        .attr("x", "5")
        .attr("dy", `19px`)
        .attr("fill", "black")
        .text(`% Fully Vaccinated People: ${nearestDateYValues1[key].toFixed(2)}`);
    }

    var tooltipWidth = tooltipText.node().getBBox().width;
    var tooltipHeight = tooltipText.node().getBBox().height;
    var rectOverlayWidth = svgElement.node().getBBox().width;
    tooltipBackground.attr("width", tooltipWidth + 10).attr("height", tooltipHeight + 10);
    if (nearestDateXCord + tooltipWidth >= rectOverlayWidth) {
      tooltip.attr("transform", "translate(" + (nearestDateXCord - tooltipWidth - 20) + "," + mouse[1] + ")");
    } else {
      tooltip.attr("transform", "translate(" + (nearestDateXCord + 10) + "," + mouse[1] + ")");
    }
  }

  function focusMouseOver() {
    mouseLine.attr("opacity", "1");
    tooltip.attr("display", null);
  }

  function focusMouseOut() {
    mouseLine.attr("opacity", "0");
    tooltip.attr("display", "none");
    svgElement.selectAll(".tooltip-line-circles").remove();
  }



}






// ---------- Tool Tip ----------- //




calltooltip(svgElement,data,xScale,yScale1,yScale,0);




function updateChart(selectedGroup) {
console.log(selectedGroup);
    // recompute line chart
if (selectedGroup==0){

var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });  

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.new_vax); });

var y_l="New Deaths per million";
var yAxis_temp=yAxis;
var y_val=-48;
var tot = 0;
var ysc = yScale;
var var_ant = 0;
 
}
else{
console.log("in the else")
var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale_tot(d.tot_cases); });

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.new_vax); });

var y_l="Total Deaths";
var yAxis_temp=yAxis_tot;
var y_val=-52;
var tot = 1;
var ysc = yScale_tot;
var var_ant = 1;
}
  


    // update the chart
svgElement.selectAll("*").remove();


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline1)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax1)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(4000)
  .ease(d3.easeLinear)
  .attr("width", 700);


mkannot(var_ant);

calltooltip(svgElement,data,xScale,yScale1,ysc,tot);

//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

var y = svgElement.append("g")
.attr("class","axisRed")
.call(yAxis_temp)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", y_val)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text(y_l);


//Add label to Y axis



var y1 = svgElement.append("g")
.attr("class","axisGreen")
.attr("transform", "translate( " + width + ", 0 )")
.call(yAxis1)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", 36)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Fully vaccinated people per 100");


}

  // Listen to the slider?
  d3.select("#selectButton").on("change", function(d){
    selectedGroup = this.value
    updateChart(selectedGroup)
  })




});

myDataPromises.catch(function() {
	console.log('Something has gone wrong.')
});



</script>
</body>
</html>