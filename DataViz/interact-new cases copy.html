<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<style>
body{ font-family: 'Trebuchet MS', sans-serif; text-align: center;}
.annotation text {
      "font-size": "10 px";
    }
.axis path, .axis line{
fill: none;
stroke: black;
stroke-width: 1;
shape-rendering: crispEdges;
}
</style>
</head>
<body>
<h3>Recent Covid-19 Trend(s) in the US</h3>

<div id="pages"></div>
<select id="selectButton"></select>
<div id="my_dataviz"></div>
<script>

// Pages 

var width_b = 1080;
var height_b = 20;
var word1 = "1";
var word2 = "2";
var word3 = "3";
var word4 = "4";
 
var holder = d3.select("#pages")
      .append("svg")
      .attr("width", width_b)    
      .attr("height", height_b); 

holder.append("text")
    .attr("x", 30)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "15px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text("Pages");


// draw a rectangle
holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20cases.html")
    .append("rect")  
    .attr("x", 60)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill","lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 70)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word1);

// Page 2

holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20hosp.html")
    .append("rect")  
    .attr("x", 85)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 95)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word2);



// Page 3

holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20deaths.html")
    .append("rect")  
    .attr("x", 110)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 120)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word3);




// Page 4 


holder.append("a")
    .attr("xlink:href", "https://srzn.github.io/DataViz/interact-new%20hosp.html")
    .append("rect")  
    .attr("x", 135)
    .attr("y", 0)
    .attr("height", 20)
    .attr("width", 20)
    .attr("rx",4)
    .attr("ry",4)
    .style("fill", "lightgrey")
    ;

// draw text on the screen
holder.append("text")
    .attr("x", 145)
    .attr("y", 10)
    .style("fill", "black")
    .style("font-size", "10px")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
    .style("pointer-events", "none")
    .text(word4);






//Set margins and sizes
var margin = {
top: 20,
bottom: 50,
right: 30,
left: 50
};

var width = 700 - margin.left - margin.right;
var height = 500 - margin.top - margin.bottom;
//Create date parser
var ParseDate = d3.timeParse("%Y-%m-%dT%H:%M:%SZ");




//Create an SVG element and append it to the DOM
var svgElement = d3.select("#my_dataviz").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");



// ------ Annotations 1 --------- //


// ==== RIGHT ====== //
const annotationsRight = [
  {
    note: {
      label: "First COVID-19 vaccine administered",
      title: "December 14, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 0,
    y: 430,
    dy: -40,
    dx: 20
  }
];

// Add annotation to the chart
const makeAnnotationsRight = d3.annotation().annotations(annotationsRight);
svgElement
  .append("g")
  .call(makeAnnotationsRight);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dasharray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 1 -------- //




// ------ Annotations 2 --------- //


// ==== RIGHT ====== //
const annotationsRight2 = [
  {
    note: {
      label: "US surpasses 25 million cases",
      title: "January 22, 2021"
    },
    connector: {
      end: "arrow",        // none, or arrow or dot
      type: "curve",       // Line or curve
      points: 2,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["grey"],
    x: 50,
    y: 130,
    dy: 70,
    dx: 40
  }
];

// Add annotation to the chart
const makeAnnotationsRight2 = d3.annotation().annotations(annotationsRight2);
svgElement
  .append("g")
  .call(makeAnnotationsRight2);

svgElement.selectAll(".connector")
  .attr('stroke', "blue")
  .style("stroke-dasharray", ("3, 3"))
svgElement.selectAll(".connector-end")
  .attr('stroke', "blue")
  .attr('fill', "blue")


// ------ Annotations 2 -------- //




//Read CSV file




var prm = [d3.csv("https://srzn.github.io/DataViz/Covid-US-Dec-14.csv")];

myDataPromises = Promise.all(prm);


myDataPromises.then(function(data) {

//Parse Data into useable format
data=data[0];
//console.log(data);
data.forEach(function(d){
d.date = ParseDate(d.date);
//console.log(d.date);
d.new_cases = +d.new_cases_smoothed_per_million;
//console.log(d.new_cases);
d.new_vax = (+d.people_fully_vaccinated_per_hundred)*10;

d.tot_cases = +d.total_cases

d.full_vax = +d.people_fully_vaccinated

//the + sign converts string automagically to number
});


// Drop down

var cases_sel = ["New Cases per million","Total Cases"];
let allGroup = Array.from(cases_sel);


d3.select("#selectButton")
    .selectAll('myOptions')
    .data(allGroup)
    .enter()
    .append('option')
    .text(function (d) { return d; }) // text showed in the menu
    .attr("value", function (d,i) { return i; })


//Create x and y scale to scale inputs
var xScale = d3.scaleTime()
             .domain(d3.extent(data, function(d){ return d.date; }))
             .range([0, width]);
var yScale = d3.scaleLinear()
             .domain([0, d3.max(data, function(d){ return d.new_cases; })]).nice()
             .range([height, 0]);

var yScale1 = d3.scaleLinear()
             .domain([1, d3.max(data, function(d){ return d.full_vax; })]).nice()
             .range([height, 0]);

//Create x and y axes
var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %y"));

var yAxis = d3.axisLeft(yScale).ticks(null,"s");



//Set the domains of our scales
//xScale.domain(d3.extent(data, function(d){ return d.date; }));
//yScale.domain([0, d3.max(data, function(d){ return d.new_cases; })]);

//Create an area generator

var initialarea = d3.area()
  .x(function(d) { return xScale(d.date); })
  .y0(height)
  .y1(height);



var area = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_cases);
});


var area_vax = d3.area()
.x(function(d){
return xScale(d.date);
})
.y0(yScale(0))
.y1(function(d){
return yScale(d.new_vax);
});


var valueline = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });


var valueline_vax = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_vax); });


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);



//append the svg path
svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(2700)
  .ease(d3.easeLinear)
  .attr("width", 700);












//svgElement.append("path")
//      .data([data])
//      .attr("class", "line")
//      .attr("d", valueline);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.call(yAxis)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", -48)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Number of Cases/Vaccinations");

//Add label to Y axis




function updateChart(selectedGroup) {
console.log(selectedGroup);
    // recompute line chart
if (selectedGroup==0){

var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_cases); });  

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.new_vax); });

var yAxis1 = d3.axisLeft(yScale).ticks(null,"s");
 
}
else{
console.log("in the else")
var valueline1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.tot_cases); });

var valueline_vax1 = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale1(d.full_vax); });

var yAxis1 = d3.axisLeft(yScale1).ticks(null,"s");

}
  


    // update the chart
svgElement.selectAll("*").remove();


var clip = svgElement.append("clipPath")
  .attr("id", "clip");
var clipRect = clip.append("rect")
  .attr("width", 0)
  .attr("height", 500);


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#ff0000")
.attr("stroke-width",1.5)
.attr("d",valueline1)
.attr("clip-path", "url(#clip)");


svgElement.append("path")
.data([data])
.attr("fill","none")
.attr("stroke","#69b3a2")
.attr("stroke-width",1.5)
.attr("d",valueline_vax1)
.attr("clip-path", "url(#clip)");

clipRect.transition()
  .duration(2700)
  .ease(d3.easeLinear)
  .attr("width", 700);


//Add X Axis
svgElement.append("g")
.attr("transform", "translate(0,"+height+")")
.call(xAxis);

//Add Y Axis
var y = svgElement.append("g")
.call(yAxis1)
.append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", -48)
    .attr("x",0)
    .attr("dy", "0.9em")
    .attr("text-anchor", "end")
    .text("Number of Cases/Vaccinations");

//Add label to Y axis



}

  // Listen to the slider?
  d3.select("#selectButton").on("change", function(d){
    selectedGroup = this.value
    updateChart(selectedGroup)
  })




});

myDataPromises.catch(function() {
	console.log('Something has gone wrong.')
});



</script>
</body>
</html>